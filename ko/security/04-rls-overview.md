# Row Level Security ê°œìš”

{% hint style="info" %}
ğŸ’¡ Row Level Security(RLS)ë¥¼ í†µí•´ í…Œì´ë¸” ë°ì´í„°ì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì„¸ë°€í•˜ê²Œ ì œì–´í•©ë‹ˆë‹¤.
{% endhint %}

## ê°œìš”

RLS(Row Level Security)ëŠ” í…Œì´ë¸” ë‹¨ìœ„ë¡œ ë°ì´í„° ì ‘ê·¼ ê¶Œí•œì„ ì œì–´í•˜ëŠ” ë³´ì•ˆ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì‚¬ìš©ì ê·¸ë£¹ë³„ë¡œ ìƒì„±, ì½ê¸°, ìˆ˜ì •, ì‚­ì œ, ëª©ë¡ ì¡°íšŒ ê¶Œí•œì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

***

## ì‚¬ìš©ì ê·¸ë£¹

bkendëŠ” 4ê°€ì§€ ì‚¬ìš©ì ê·¸ë£¹ìœ¼ë¡œ ê¶Œí•œì„ êµ¬ë¶„í•©ë‹ˆë‹¤.

| ê·¸ë£¹ | ì„¤ëª… | ê²°ì • ê¸°ì¤€ |
|------|------|----------|
| `admin` | ê´€ë¦¬ì | API í‚¤ ì¸ì¦ (Secret Key) ë˜ëŠ” ê´€ë¦¬ì ì—­í•  |
| `user` | ì¸ì¦ëœ ì‚¬ìš©ì | JWT í† í° ì¸ì¦ |
| `guest` | ë¯¸ì¸ì¦ ì‚¬ìš©ì | ì¸ì¦ ì—†ìŒ |
| `self` | ë³¸ì¸ ë°ì´í„° | `createdBy`ê°€ ë³¸ì¸ì¸ ë°ì´í„° |

### ê·¸ë£¹ ê²°ì • íë¦„

```mermaid
flowchart TD
    A[API ìš”ì²­] --> B{ì¸ì¦ í† í°?}
    B -->|Secret Key| C[admin]
    B -->|JWT ê´€ë¦¬ì ì—­í• | C
    B -->|JWT ì¼ë°˜ ì‚¬ìš©ì| D[user]
    B -->|ì—†ìŒ| E[guest]
```

***

## ê¶Œí•œ ëª¨ë¸

ê° í…Œì´ë¸”ì—ëŠ” ì‚¬ìš©ì ê·¸ë£¹ë³„ CRUD + List ê¶Œí•œì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ê¶Œí•œ ì¢…ë¥˜

| ê¶Œí•œ | ì„¤ëª… | API |
|------|------|-----|
| `create` | ë°ì´í„° ìƒì„± | `POST /v1/data/:tableName` |
| `read` | ë‹¨ê±´ ì¡°íšŒ | `GET /v1/data/:tableName/:id` |
| `update` | ë°ì´í„° ìˆ˜ì • | `PATCH /v1/data/:tableName/:id` |
| `delete` | ë°ì´í„° ì‚­ì œ | `DELETE /v1/data/:tableName/:id` |
| `list` | ëª©ë¡ ì¡°íšŒ | `GET /v1/data/:tableName` |

### ê¸°ë³¸ ê¶Œí•œ (ë¯¸ì„¤ì • ì‹œ)

| ê·¸ë£¹ | create | read | update | delete | list |
|------|:------:|:----:|:------:|:------:|:----:|
| `admin` | âœ… | âœ… | âœ… | âœ… | âœ… |
| `user` | âœ… | âœ… | âŒ | âŒ | âœ… |
| `guest` | âŒ | âœ… | âŒ | âŒ | âœ… |

{% hint style="warning" %}
âš ï¸ `admin` ê·¸ë£¹ì€ í•­ìƒ ëª¨ë“  ê¶Œí•œì„ ê°€ì§‘ë‹ˆë‹¤. ë³„ë„ ì„¤ì •ê³¼ ê´€ê³„ì—†ì´ ì œí•œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
{% endhint %}

***

## self ê¶Œí•œ

`self` ê¶Œí•œì€ **ë³¸ì¸ì´ ìƒì„±í•œ ë°ì´í„°**ì—ë§Œ ì ìš©ë˜ëŠ” íŠ¹ìˆ˜ ê¶Œí•œì…ë‹ˆë‹¤.

### ë™ì‘ ë°©ì‹

- ë°ì´í„°ì˜ `createdBy` í•„ë“œê°€ ìš”ì²­ìì˜ ì‚¬ìš©ì IDì™€ ì¼ì¹˜í•˜ë©´ í—ˆìš©
- ëª©ë¡ ì¡°íšŒ ì‹œ `self` ê¶Œí•œë§Œ ìˆìœ¼ë©´ **ìë™ìœ¼ë¡œ ë³¸ì¸ ë°ì´í„°ë§Œ í•„í„°ë§**

### ì˜ˆì‹œ

`user` ê·¸ë£¹ì— `update: false`, `self.update: true`ë¡œ ì„¤ì •í•˜ë©´:

- ë‹¤ë¥¸ ì‚¬ìš©ìì˜ ë°ì´í„°: ìˆ˜ì • **ë¶ˆê°€**
- ë³¸ì¸ì´ ìƒì„±í•œ ë°ì´í„°: ìˆ˜ì • **ê°€ëŠ¥**

***

## ì‹œìŠ¤í…œ í…Œì´ë¸”

ì´ë¦„ì´ `_`ë¡œ ì‹œì‘í•˜ëŠ” í…Œì´ë¸”ì€ ì‹œìŠ¤í…œ í…Œì´ë¸”ì…ë‹ˆë‹¤.

{% hint style="warning" %}
âš ï¸ ì‹œìŠ¤í…œ í…Œì´ë¸”ì€ `admin` ê·¸ë£¹ë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¶Œí•œ ì„¤ì •ê³¼ ê´€ê³„ì—†ì´ `user`ì™€ `guest`ëŠ” ì ‘ê·¼ì´ ì°¨ë‹¨ë©ë‹ˆë‹¤.
{% endhint %}

***

## ë‹¤ìŒ ë‹¨ê³„

- [RLS ì •ì±… ì‘ì„±](05-rls-policies.md) â€” í…Œì´ë¸”ë³„ ê¶Œí•œ ì„¤ì • ë°©ë²•
- [Public Key vs Secret Key](03-public-vs-secret.md) â€” í‚¤ ì¢…ë¥˜ë³„ ê¶Œí•œ ì°¨ì´
- [ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€](07-best-practices.md) â€” RLS ì„¤ì • ê¶Œì¥ ì‚¬í•­
