# API í‚¤ ì´í•´

{% hint style="info" %}
ğŸ’¡ bkend API í‚¤ì˜ êµ¬ì¡°, ìƒì„± ë°©ì‹, ë³´ì•ˆ íŠ¹ì„±ì„ ì´í•´í•©ë‹ˆë‹¤.
{% endhint %}

## ê°œìš”

API í‚¤ëŠ” bkend ì„œë¹„ìŠ¤ APIì— ì ‘ê·¼í•˜ê¸° ìœ„í•œ ì¸ì¦ ìˆ˜ë‹¨ì…ë‹ˆë‹¤. ì½˜ì†”ì—ì„œ ìƒì„±í•˜ë©°, `X-API-Key` í—¤ë”ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤. API í‚¤ì—ëŠ” í”„ë¡œì íŠ¸ IDì™€ í™˜ê²½ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ë³„ë„ì˜ ì»¨í…ìŠ¤íŠ¸ í—¤ë” ì—†ì´ ìš”ì²­í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

***

## API í‚¤ ì¢…ë¥˜

bkendëŠ” ë‘ ê°€ì§€ ìœ í˜•ì˜ API í‚¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤.

| í•­ëª© | Publishable Key | Secret Key |
|------|----------------|------------|
| **Prefix** | `pk_` | `sk_` |
| **ì‚¬ìš© í™˜ê²½** | í´ë¼ì´ì–¸íŠ¸ (ë¸Œë¼ìš°ì €, ëª¨ë°”ì¼) | ì„œë²„ ì‚¬ì´ë“œë§Œ |
| **ê¶Œí•œ** | RLS ê¸°ë°˜ ì œí•œëœ ì ‘ê·¼ | ì „ì²´ ì ‘ê·¼ (admin) |
| **ë…¸ì¶œ ìœ„í—˜** | ë‚®ìŒ (RLSë¡œ ë³´í˜¸) | ë†’ìŒ (ì „ì²´ ê¶Œí•œ) |

***

## API í‚¤ êµ¬ì¡°

### í‚¤ í˜•ì‹

```text
pk_a1b2c3d4e5f6...  (pk_ + 64ì hex)
sk_a1b2c3d4e5f6...  (sk_ + 64ì hex)
```

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
|----------|------|
| `pk_` / `sk_` | í‚¤ ìœ í˜• prefix |
| 64ì hex | 32ë°”ì´íŠ¸ ëœë¤ ê°’ (ì•”í˜¸í•™ì  ë‚œìˆ˜) |

### í¬í•¨ ì •ë³´

API í‚¤ëŠ” ìƒì„± ì‹œ ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. API ìš”ì²­ ì‹œ ì„œë²„ê°€ ì´ ì •ë³´ë¥¼ ìë™ìœ¼ë¡œ ì¶”ì¶œí•˜ë¯€ë¡œ ë³„ë„ í—¤ë”ê°€ ë¶ˆí•„ìš”í•©ë‹ˆë‹¤.

| ì •ë³´ | ì„¤ëª… |
|------|------|
| Project ID | í‚¤ê°€ ì†í•œ í”„ë¡œì íŠ¸ |
| Environment | ëŒ€ìƒ í™˜ê²½ (`dev`, `staging`, `prod`) |
| Scopes | í…Œì´ë¸”/ì‘ì—…ë³„ ì ‘ê·¼ ë²”ìœ„ |

### ë³´ì•ˆ ì €ì¥ ë°©ì‹

API í‚¤ëŠ” ìƒì„± ì‹œ **SHA-256 í•´ì‹œ**ë¡œ ë³€í™˜ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤. ì›ë³¸ í‚¤ëŠ” ì €ì¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```mermaid
flowchart LR
    A[í‚¤ ìƒì„±] -->|randomBytes 32| B["pk_xxx / sk_xxx"]
    B -->|SHA-256| C[í•´ì‹œê°’ ì €ì¥]
    B -->|1íšŒ ë°˜í™˜| D[ì‚¬ìš©ìì—ê²Œ í‘œì‹œ]
```

{% hint style="danger" %}
ğŸš¨ **ìœ„í—˜** â€” API í‚¤ëŠ” ìƒì„± ì‹œ **ë‹¨ í•œ ë²ˆë§Œ** í‘œì‹œë©ë‹ˆë‹¤. ì•ˆì „í•œ ê³³ì— ì¦‰ì‹œ ì €ì¥í•˜ì„¸ìš”.
{% endhint %}

***

## API í‚¤ ì†ì„±

| ì†ì„± | ì„¤ëª… |
|------|------|
| Organization | í‚¤ê°€ ì†í•œ ì¡°ì§ |
| í”„ë¡œì íŠ¸ ë²”ìœ„ | ì ‘ê·¼ ê°€ëŠ¥í•œ í”„ë¡œì íŠ¸ (ì „ì²´ ë˜ëŠ” íŠ¹ì •) |
| ìŠ¤ì½”í”„ | í…Œì´ë¸” ë° ì‘ì—…ë³„ ê¶Œí•œ ë²”ìœ„ (ì•„ë˜ ì°¸ì¡°) |
| ë§Œë£Œ ì‹œê°„ | ì„ íƒ ì‚¬í•­ (ë¯¸ì„¤ì • ì‹œ ì˜êµ¬) |
| ìƒì„±ì | í‚¤ë¥¼ ìƒì„±í•œ ì‚¬ìš©ì |

### API í‚¤ ìŠ¤ì½”í”„

ìŠ¤ì½”í”„ë¥¼ ì‚¬ìš©í•˜ë©´ API í‚¤ê°€ ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” í…Œì´ë¸”ê³¼ ì‘ì—…ì„ ì œí•œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìŠ¤ì½”í”„ê°€ ì„¤ì •ë˜ë©´ ëª¨ë“  API ìš”ì²­ì—ì„œ RLS ê¶Œí•œ ê²€ì‚¬ **ì´ì „ì—** ìŠ¤ì½”í”„ë¥¼ ë¨¼ì € í™•ì¸í•©ë‹ˆë‹¤.

| ìŠ¤ì½”í”„ í˜•ì‹ | ì„¤ëª… | ì˜ˆì‹œ |
|------------|------|------|
| `{tableName}:{operation}` | íŠ¹ì • í…Œì´ë¸”ì˜ íŠ¹ì • ì‘ì—… í—ˆìš© | `posts:read` |
| `{tableName}:*` | íŠ¹ì • í…Œì´ë¸”ì˜ ëª¨ë“  ì‘ì—… í—ˆìš© | `posts:*` |
| `*:{operation}` | ëª¨ë“  í…Œì´ë¸”ì˜ íŠ¹ì • ì‘ì—… í—ˆìš© | `*:read` |
| `*:*` | ëª¨ë“  í…Œì´ë¸”ì˜ ëª¨ë“  ì‘ì—… í—ˆìš© | `*:*` |

{% hint style="warning" %}
âš ï¸ ìŠ¤ì½”í”„ ê²€ì‚¬ëŠ” RLS ê¶Œí•œ ê²€ì‚¬ **ì´ì „ì—** ì ìš©ë©ë‹ˆë‹¤. `admin` ê·¸ë£¹ì´ë¼ë„ ìŠ¤ì½”í”„ ì œí•œì„ ìš°íšŒí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ìš”ì²­í•œ ì‘ì—…ì´ ìŠ¤ì½”í”„ì— í¬í•¨ë˜ì§€ ì•Šìœ¼ë©´ `403 SCOPE_INSUFFICIENT` ì—ëŸ¬ê°€ ë°˜í™˜ë©ë‹ˆë‹¤.
{% endhint %}

***

## API í‚¤ ê²€ì¦ íë¦„

```mermaid
sequenceDiagram
    participant C as í´ë¼ì´ì–¸íŠ¸
    participant A as bkend API
    participant DB as ë°ì´í„°ë² ì´ìŠ¤

    C->>A: X-API-Key: pk_xxx...
    A->>A: 1. Prefix í™•ì¸ (pk_ / sk_)
    A->>A: 2. SHA-256 í•´ì‹œ ìƒì„±
    A->>DB: 3. í•´ì‹œë¡œ ì¡°íšŒ
    DB-->>A: 4. í‚¤ ì •ë³´ ë°˜í™˜ (projectId, environment, scopes)
    A->>A: 5. íê¸°/ë§Œë£Œ í™•ì¸
    A-->>C: 6. ìš”ì²­ ì²˜ë¦¬
```

### ê²€ì¦ ì‹¤íŒ¨ ì‚¬ìœ 

| ì‚¬ìœ  | HTTP | ì„¤ëª… |
|------|:----:|------|
| ì˜ëª»ëœ í˜•ì‹ | 401 | `pk_` / `sk_` prefixê°€ ì•„ë‹Œ ê²½ìš° |
| í‚¤ ì—†ìŒ | 401 | í•´ì‹œì— í•´ë‹¹í•˜ëŠ” í‚¤ê°€ ì—†ëŠ” ê²½ìš° |
| íê¸°ë¨ | 401 | í‚¤ê°€ íê¸°ëœ ê²½ìš° |
| ë§Œë£Œë¨ | 401 | ë§Œë£Œ ì‹œê°„ì´ ì§€ë‚œ ê²½ìš° |

***

## API í‚¤ ê´€ë¦¬

### ì½˜ì†”ì—ì„œ ê´€ë¦¬í•˜ê¸°

ì½˜ì†”ì˜ **API í‚¤** ë©”ë‰´ì—ì„œ API í‚¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í† í° ìƒì„±, ê¶Œí•œ ì„¤ì •, íê¸° ë“±ì˜ ìƒì„¸ ë°©ë²•ì€ ì½˜ì†” ê°€ì´ë“œë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

â†’ [API í‚¤ ê´€ë¦¬ (ì½˜ì†”)](../console/11-api-keys.md)

### 5ë¶„ ë§Œì— API Key ë°œê¸‰í•˜ê³  í…ŒìŠ¤íŠ¸í•˜ê¸°

1. ì½˜ì†” â†’ **API í‚¤** â†’ **ìƒˆ í† í° ìƒì„±**ì„ í´ë¦­í•˜ì„¸ìš”.
2. í† í° ì´ë¦„: `test-key`, íƒ€ì…: Publishable Key, ê¶Œí•œ: `Table Data (read, create)`.
3. **ìƒì„±** í›„ í‘œì‹œëœ í† í°ì„ ë³µì‚¬í•˜ì„¸ìš”.
4. curlë¡œ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”:

```bash
curl -X GET https://api-client.bkend.ai/v1/data/posts \
  -H "X-API-Key: {pk_publishable_key}"
```

{% hint style="success" %}
âœ… 200 ì‘ë‹µì´ ëŒì•„ì˜¤ë©´ API Keyê°€ ì •ìƒ ë™ì‘í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.
{% endhint %}

### API í‚¤ ì‚¬ìš© ì˜ˆì‹œ (JavaScript)

```javascript
// Publishable Keyë¥¼ X-API-Key í—¤ë”ì— í¬í•¨
const response = await fetch('https://api-client.bkend.ai/v1/data/posts', {
  headers: {
    'X-API-Key': '{pk_publishable_key}',
  },
});

const data = await response.json();
```

ì•±ì—ì„œ bkend APIë¥¼ ì—°ë™í•˜ëŠ” ìƒì„¸ ë°©ë²•ì€ [ì•±ì—ì„œ bkend ì—°ë™í•˜ê¸°](../getting-started/03-app-integration.md)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

***

## ë‹¤ìŒ ë‹¨ê³„

- [Publishable Key vs Secret Key](03-public-vs-secret.md) â€” í‚¤ ì¢…ë¥˜ë³„ ì‚¬ìš©ë²•
- [API í‚¤ ê´€ë¦¬ (ì½˜ì†”)](../console/11-api-keys.md) â€” ì½˜ì†”ì—ì„œ í† í° ìƒì„±/ê´€ë¦¬
- [ì•±ì—ì„œ bkend ì—°ë™í•˜ê¸°](../getting-started/03-app-integration.md) â€” ì•±ì— API Key ì„¤ì •í•˜ê¸°
- [ë³´ì•ˆ ëª¨ë²” ì‚¬ë¡€](07-best-practices.md) â€” API í‚¤ ë³´ì•ˆ ê¶Œì¥ ì‚¬í•­
